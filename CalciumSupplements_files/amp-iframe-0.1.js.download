(window.AMP = window.AMP || []).push({n:"amp-iframe", f:(function(AMP) {var process={env:{NODE_ENV:"production"}};var g;function h(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;for(var c in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,c);e&&Object.defineProperty(a,c,e)}else a[c]=b[c]};(new Date).getTime();self.log=self.log||{user:null,dev:null};var l=self.log;function r(){if(l.user)return l.user;throw Error("failed to call initLogConstructor");};function t(a){a=a.__AMP_TOP||a;var b=a.services&&a.services.timer&&a.services.timer.obj;return b};function w(a,b){var d=a.length-b.length;return 0<=d&&a.indexOf(b,d)==d};var x=(self.AMP_CONFIG||{}).thirdPartyFrameHost||"ampproject.net";var y,A;
function B(a){var b;y||(y=self.document.createElement("a"),A=self.UrlCache||(self.UrlCache=Object.create(null)));var d=A[a];if(d)return d;y.href=a;y.protocol||(y.href=y.href);var c={href:y.href,protocol:y.protocol,host:y.host,hostname:y.hostname,port:"0"==y.port?"":y.port,pathname:y.pathname,search:y.search,hash:y.hash,origin:null};"/"!==c.pathname[0]&&(c.pathname="/"+c.pathname);if("http:"==c.protocol&&80==c.port||"https:"==c.protocol&&443==c.port)c.port="",c.host=c.hostname;c.origin=y.origin&&"null"!=
y.origin?y.origin:"data:"!=c.protocol&&c.host?c.protocol+"//"+c.host:c.href;var e=c;return b?e:A[a]=e};function C(a,b,d){if(!(0==b&&0==d||0==a.width&&0==a.height)){b=a.left+b;d=a.top+d;var c=a.width;a=a.height;a={left:b,top:d,width:c,height:a,bottom:d+a,right:b+c}}return a};function D(a,b){for(var d=[],c=0;c<a.length;c++){var e=a[c];b(e,c,a)||(d.push(e),a.splice(c,1),c--)}};function E(a,b,d){var c=a.listeningFors;!c&&d&&(c=a.listeningFors=Object.create(null));a=c||null;if(!a)return a;var e=a[b];!e&&d&&(e=a[b]=[]);return e||null}function F(a,b,d){var c=B(b.src).origin,e=d?b.getAttribute("data-amp-3p-sentinel"):"amp";a=E(a,e,!0);for(var f,e=0;e<a.length;e++){var p=a[e];if(p.frame===b){f=p;break}}f||(f={frame:b,origin:c,events:Object.create(null)},a.push(f));return f.events}
function G(a){for(var b={sentinel:"unlisten"},d=a.length-1;0<=d;d--){var c=a[d];if(!c.frame.contentWindow){a.splice(d,1);var e=c.events,f;for(f in e)e[f].splice(0,Infinity).forEach(function(a){a(b)})}}}
function I(a){if(!a.listeningFors){var b=function(d){if(d.data){var c=d.data;if("string"===typeof c&&"{"===c.charAt(0))try{c=JSON.parse(c)}catch(Q){var b;if(l.dev)b=l.dev;else throw Error("failed to call initLogConstructor");b.warn("Postmessage could not be parsed. Is it in a valid JSON format?",Q)}if(c.sentinel){var f;b=c.sentinel;var p=d.origin,m=d.source,n=E(a,b);if(n){for(var z=0;z<n.length;z++){var u=n[z],v=u.frame.contentWindow;if(v)if("amp"===b){if(u.origin===p&&v==m){f=u;break}}else{var k;
if(!(k=m==v))b:{for(k=m;k&&k!=k.parent;k=k.parent)if(k==v){k=!0;break b}k=!1}if(k){f=u;break}}else setTimeout(G,0,n)}f=f?f.events:null}else f=n;var H=f;if(H){var q=H[c.type];if(q)for(q=q.slice(),f=0;f<q.length;f++)(0,q[f])(c,d.source,d.origin)}}}};a.addEventListener("message",b)}}
function J(a,b,d,c,e){function f(c,b,f){if(e||b==a.contentWindow)"unlisten"==c.sentinel?n():d(c,b,f)}var p=a.ownerDocument.defaultView;I(p);c=F(p,a,c);var m=c[b]||(c[b]=[]),n;m.push(f);return n=function(){if(f){var a=m.indexOf(f);-1<a&&m.splice(a,1);d=m=f=null}}}function K(a,b,d,c,e){if(a.contentWindow){c.type=d;c.sentinel=e?a.getAttribute("data-amp-3p-sentinel"):"amp";var f=c;e&&(f="amp-"+JSON.stringify(c));for(a=0;a<b.length;a++)d=b[a],d.win.postMessage(f,d.origin)}}
function L(a,b,d,c){var e=this;this.a=a;this.m=d;this.h=[];this.I=J(this.a,b,function(a,b,d){e.h.some(function(a){return a.win==b})||e.h.push({win:b,origin:d});c(a,b,d)},this.m,this.m)}L.prototype.send=function(a,b){D(this.h,function(a){return!!a.win.parent});K(this.a,this.h,a,b,this.m)};L.prototype.destroy=function(){this.I();this.h.length=0};function M(a,b,d){var c=this;this.g=a;this.G=t(a.win);this.inViewport_=this.F=!1;this.f=[];this.i=0;this.H=this.B.bind(this);this.D=new L(b,"send-intersections",d||!1,function(){return N(c)});this.c=null}M.prototype.fire=function(){if(this.F){var a=this.g.element.getIntersectionChangeEntry();0<this.f.length&&this.f[this.f.length-1].time==a.time||(this.f.push(a),this.i||(this.B(),this.i=this.G.delay(this.H,100)))}};
function N(a){a.F=!0;a.g.getVsync().measure(function(){if(a.g.isInViewport())a.onViewportCallback(!0);a.fire()})}M.prototype.onViewportCallback=function(a){if(this.inViewport_!=a)if(this.inViewport_=a,this.fire(),a){var b=this.fire.bind(this),d=this.g.getViewport().onScroll(b),c=this.g.getViewport().onChanged(b);this.c=function(){d();c()}}else this.c&&(this.c(),this.c=null)};M.prototype.B=function(){this.i=0;this.f.length&&(this.D.send("intersection",{changes:this.f}),this.f.length=0)};
M.prototype.destroy=function(){this.G.cancel(this.i);this.c&&(this.c(),this.c=null);this.D.destroy()};var O={"AMP-FX-FLYING-CARPET":!0,"AMP-LIGHTBOX":!0,"AMP-STICKY-AD":!0};var P=0,R=0;function S(a){AMP.BaseElement.apply(this,arguments)}h(S,AMP.BaseElement);g=S.prototype;g.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a};
g.assertSource=function(a,b,d){var c=B(a);r().assert("https:"==c.protocol||"data:"==c.protocol||0==c.origin.indexOf("http://iframe.localhost:"),"Invalid <amp-iframe> src. Must start with https://. Found %s",this.element);var e=B(b);r().assert(!(" "+d+" ").match(/\s+allow-same-origin\s+/i)||c.origin!=e.origin&&"data:"!=c.protocol,"Origin of <amp-iframe> must not be equal to container %sif allow-same-origin is set. See https://github.com/ampproject/amphtml/blob/master/spec/amp-iframe-origin-policy.md for details.",
this.element);r().assert(!(w(c.hostname,"."+x)||w(c.hostname,".ampproject.org")),"amp-iframe does not allow embedding of frames from ampproject.*: %s",a);return a};
g.assertPosition=function(){var a=this.element.getLayoutBox(),b=Math.min(600,.75*this.getViewport().getSize().height);r().assert(a.top>=b,"<amp-iframe> elements must be positioned outside the first 75% of the viewport or 600px from the top (whichever is smaller): %s  Current position %s. Min: %sPositioning rules don't apply for iframes that use `placeholder`.See https://github.com/ampproject/amphtml/blob/master/extensions/amp-iframe/amp-iframe.md#iframe-with-placeholder for details.",this.element,
a.top,b)};g.transformSrcDoc=function(a,b){if(a)return r().assert(!(" "+b+" ").match(/\s+allow-same-origin\s+/i),"allow-same-origin is not allowed with the srcdoc attribute %s.",this.element),"data:text/html;charset=utf-8;base64,"+btoa(a)};
g.firstAttachedCallback=function(){this.w=this.element.getAttribute("sandbox");var a=this.element.getAttribute("src")||this.transformSrcDoc(this.element.getAttribute("srcdoc"),this.w);this.iframeSrc=this.assertSource(a,window.location.href,this.w);var b;b=this.element;if("no"!=b.getAttribute("scrolling")){var d=b.ownerDocument.createElement("i-amp-scroll-container");b.appendChild(d);b=d}this.l=b};g.preconnectCallback=function(a){this.iframeSrc&&this.preconnect.url(this.iframeSrc,a)};
g.buildCallback=function(){this.v=this.getPlaceholder();this.s=!!this.v;this.C=this.o=!1;this.a=this.j=this.c=null;(this.u=this.element.hasAttribute("resizable"))&&this.element.setAttribute("scrolling","no");this.b=null;this.element.hasAttribute("frameborder")||this.element.setAttribute("frameborder","0")};
g.onLayoutMeasure=function(){T(this);var a;a:{var b=this.getIntersectionElementLayoutBox();a=b.height;for(var b=b.width,d=0;d<U.length;d++){var c=U[d][0],e=U[d][1];if(!(e>a||c>b)&&20>=a-e&&20>=b-c){a=!0;break a}}a=!1}if(a=this.o=a){a=this.win;b=!1;d=0;c=this.element;do O[c.tagName]?(d++,b=!1):"fixed"==a.getComputedStyle(c).position&&(b=!0),c=c.parentElement;while(c&&"BODY"!=c.tagName);a=!(!b&&1>=d)}this.C=a;this.b&&this.b.fire()};
function T(a){if(a.a){var b=a.getViewport().getLayoutRect(a.a),d=a.getLayoutBox();a.j=C(b,-d.left,-d.top)}}g.getIntersectionElementLayoutBox=function(){if(!this.a)return AMP.BaseElement.prototype.getIntersectionElementLayoutBox.call(this);var a=this.getLayoutBox();this.j||T(this);return C(a,this.j.left,this.j.top)};
g.layoutCallback=function(){var a=this;r().assert(!this.C,"amp-iframe is not used for displaying fixed ad. Please use amp-sticky-ad and amp-ad instead.");this.s||this.assertPosition();this.u&&r().assert(this.getOverflowElement(),"Overflow element must be defined for resizable frames: %s",this.element);if(!this.iframeSrc)return Promise.resolve();var b=V(this);if(b&&(R++,1<R))return console.error("Only 1 analytics/tracking iframe allowed per page. Please use amp-analytics instead or file a GitHub issue for your use case: https://github.com/ampproject/amphtml/issues/new"),
Promise.resolve();var d=this.element.ownerDocument.createElement("iframe");this.a=d;this.applyFillContent(d);d.name="amp_iframe"+P++;this.s&&(d.style.zIndex=-1);this.propagateAttributes(["frameborder","allowfullscreen","allowtransparency","scrolling","referrerpolicy"],d);W(d,this.w);d.src=this.iframeSrc;b||(this.b=new M(this,d));d.onload=function(){d.readyState="complete";a.A();b&&(a.iframeSrc=null,t(a.win).promise(5E3).then(function(){d.parentElement&&d.parentElement.removeChild(d);a.element.setAttribute("amp-removed",
"");a.a=null}))};J(d,"embed-size",function(b){X(a,b.height,b.width)});this.s&&J(d,"embed-ready",this.A.bind(this));this.l.appendChild(d);return this.loadPromise(d).then(function(){a.l!=a.element&&t(a.win).delay(function(){a.deferMutate(function(){a.l.classList.add("amp-active")})},1E3)})};g.unlayoutOnPause=function(){return!0};
g.unlayoutCallback=function(){if(this.a){var a=this.a;a.parentElement&&a.parentElement.removeChild(a);this.v&&this.togglePlaceholder(!0);this.a=null;this.b&&(this.b.destroy(),this.b=null)}return!0};g.viewportCallback=function(a){if(this.b)this.b.onViewportCallback(a)};g.getPriority=function(){return this.o?2:AMP.BaseElement.prototype.getPriority.call(this)};g.A=function(){var a=this;this.v&&this.getVsync().mutate(function(){a.a&&(a.a.style.zIndex=0,a.togglePlaceholder(!1))})};
g.firstLayoutCompleted=function(){};
function X(a,b,d){if(a.u)if(100>b)r().error("amp-iframe","Ignoring embed-size request because the resize height is less than 100px. If you are using amp-iframe to display ads, consider using amp-ad instead.",a.element);else{var c,e;void 0!==b&&(c=Math.max(a.element.offsetHeight-a.a.offsetHeight+b,b));void 0!==d&&(e=Math.max(a.element.offsetWidth-a.a.offsetWidth+d,d));void 0!==c||void 0!==e?a.attemptChangeSize(c,e).then(function(){void 0!==c&&a.element.setAttribute("height",c);void 0!==e&&a.element.setAttribute("width",
e)},function(){}):r().error("amp-iframe","Ignoring embed-size request becauseno width or height value is provided",a.element)}else r().error("amp-iframe","Ignoring embed-size request because this iframe is not resizable",a.element)}function V(a){a=a.element.getLayoutBox();return 10<a.width&&10<a.height?!1:!0}function W(a,b){var d=b||"";a.setAttribute("sandbox",d)}var U=[[300,250],[320,50],[300,50],[320,100]];AMP.registerElement("amp-iframe",S);
})});
//# sourceMappingURL=amp-iframe-0.1.js.map

